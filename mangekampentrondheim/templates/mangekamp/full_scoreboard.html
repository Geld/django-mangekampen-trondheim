{% extends 'mangekamp/base.html' %}
{% load filters %}

{% block scripts %}
<script>
    $(".results_btn").click(function() {
        var btn = $(this);
        var loading = $("#loading-indicator");
        var loading_anim_timer = setTimeout(function() {
            loading.show();
        }, 100);
        var event_id = btn.attr('id').split("_")[1];
        $("#modal_dialog").load("/results/"+event_id, function() {
            $("#modal_dialog").modal();
            clearTimeout(loading_anim_timer);
            loading.hide();
        });
    });

</script>

{% endblock %}

{% block content %}

<table class="table table-hover full-scoreboard">
    <thead>
        <tr>
            <th>Navn</th>
            <th>Arrangementer</th>
            <th>Kategorier</th>
            <th>Status</th>       
            {% for event in events %}
            <th><a class="btn btn-primary results_btn" id="results_{{event.id}}" >{{ event.name }}</a></th>    
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for key, value in users.items %}
        <tr>
            <td>
                {{ key.get_full_name }}
            </td>
            <td>
                {{ value.attendance }} / 7
            </td>
            <td>
                {{ value.categories|length }} / 3
            </td>
            <td>
                {{ season|to_mangekjemper_status:value|safe }}
            </td>
            {% for field, fieldvalue in value.items %}
                {% if field == "events" %}
                    {% for eventname, score in fieldvalue.items %}
                    <td>{{ score }}</td>
                    {% endfor %}
                {% endif %}
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>

    <div class="modal" style="display:none;" id="modal_dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    </div>
{% endblock %}
